<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Rspress v1.11.2"><title data-rh="true">nginx配置 - zhifou</title><meta data-rh="true" name="description" content="知否 Blog"/><meta data-rh="true" name="referrer" content="no-referrer-when-downgrade"/>
<script id="check-dark-light">
;(() => {
  const saved = localStorage.getItem('rspress-theme-appearance')
  const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
  if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
    document.documentElement.classList.add('dark')
  }
})()
</script>
<title>zhifou</title><link rel="icon" href="/favicon.ico"><script defer="defer" src="/static/js/lib-lodash.4cfcb11a.js"></script><script defer="defer" src="/static/js/lib-polyfill.348ddd3c.js"></script><script defer="defer" src="/static/js/lib-react.488da7dd.js"></script><script defer="defer" src="/static/js/lib-router.8a2efe16.js"></script><script defer="defer" src="/static/js/73.ba51e90f.js"></script><script defer="defer" src="/static/js/index.cf43d8b7.js"></script><link href="/static/css/73.e7f0d4f2.css" rel="stylesheet"><link href="/static/css/index.652aa3d1.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" rel="stylesheet" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous"></head><body ><div id="root"><div><div><div class="navContainer_f6cde sticky rspress-nav px-6 "><div class="container_f6cde flex justify-between items-center h-full"><div class="navBarTitle_f6cde"><a href="/" class="flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60"><span>zhifou</span></a></div><div class="undefined flex flex-1 justify-end items-center"><div class="rightNav_f6cde"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_6e282"><button><svg width="18" height="24" viewBox="0 0 32 32" hight="18"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg><p class="searchWord_6e282">搜索...</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_6e282"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><a class="link_03735  cursor-pointer" target="" href="/guide/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">未来指引</div></a><a class="link_03735  cursor-pointer" target="" href="/blog/flinks/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">友情链接</div></a><a class="link_03735  cursor-pointer" target="" href="/blog/archives/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">归档</div></a><a class="link_03735  cursor-pointer" target="" href="/blog/categories/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">分类</div></a><a class="link_03735  cursor-pointer" target="" href="/blog/tags/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">标签</div></a><a class="link_03735  cursor-pointer" target="" href="/about/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">关于我</div></a></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zM12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3zM19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3zM3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3zM18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3z"></path></svg></div></div></div><div class="social-links menu-item_93d67 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/zhifou/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></div></a><a href="https://twitter.com/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></div></a></div></div></div></div><div class="mobileNavMenu_f6cde"><div class="navScreen_457e8 " id="navScreen"><div class="container_457e8"><div class="navMenu_457e8"><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/guide/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">未来指引</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/blog/flinks/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">友情链接</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/blog/archives/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">归档</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/blog/categories/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">分类</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/blog/tags/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">标签</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/about/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">关于我</div></a></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_457e8 flex justify-center"></div><div class="social-links menu-item_93d67 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/zhifou/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></div></a><a href="https://twitter.com/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></div></a></div></div></div></div></div><button class=" navHamburger_e7b06 text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_edeb4 pt-0"><div class="content_edeb4 rspress-doc-container flex flex-shrink-0 mx-auto"><div class="w-full"><div><div class="rspress-doc"><!--$--><h2 id="nginxconf基本配置有哪些" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#nginxconf基本配置有哪些">#</a>nginx.conf基本配置有哪些？</h2>
<p class="my-4 leading-7"><strong class="font-semibold">nginx配置文件主要分成四个部分：</strong></p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">main，全局设置，影响其它部分所有设置</li>
<li class="[&amp;:not(:first-child)]:mt-2">server，主机服务相关设置，主要用于指定虚拟主机域名、IP和端口</li>
<li class="[&amp;:not(:first-child)]:mt-2">location，URL匹配特定位置后的设置，反向代理、内容篡改相关设置</li>
<li class="[&amp;:not(:first-child)]:mt-2">upstream，上游服务器设置，负载均衡相关配置</li>
</ul>
<p class="my-4 leading-7">他们之间的关系式：server继承main，location继承server；</p>
<p class="my-4 leading-7">upstream既不会继承指令也不会被继承。</p>
<p class="my-4 leading-7"><strong class="font-semibold">通用的配置和详解：</strong></p>
<div class="language-nginx"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-nginx" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>#定义 Nginx 运行的用户和用户组,默认由 nobody 账号运行, windows 下面可以注释掉。 
</span></span><span style="display:block;padding:0 1.25rem">user  nobody;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">#nginx进程数，建议设置为等于CPU总核心数。可以和worker_cpu_affinity配合
</span><span style="display:block;padding:0 1.25rem">worker_processes  1;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]
</span><span style="display:block;padding:0 1.25rem">#error_log  logs/error.log;
</span><span style="display:block;padding:0 1.25rem">#error_log  logs/error.log  notice;
</span><span style="display:block;padding:0 1.25rem">#error_log  logs/error.log  info;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">#进程文件，window下可以注释掉
</span><span style="display:block;padding:0 1.25rem">#pid    logs/nginx.pid;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">#一个nginx进程打开的最多文件描述符(句柄)数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，
</span><span style="display:block;padding:0 1.25rem">#但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。
</span><span style="display:block;padding:0 1.25rem">worker_rlimit_nofile 65535;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">#工作模式与连接数上限
</span><span style="display:block;padding:0 1.25rem">events {
</span><span style="display:block;padding:0 1.25rem">   #参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; 
</span><span style="display:block;padding:0 1.25rem">   #epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。
</span><span style="display:block;padding:0 1.25rem">   #use epoll;
</span><span style="display:block;padding:0 1.25rem">   #connections 20000;  # 每个进程允许的最多连接数
</span><span style="display:block;padding:0 1.25rem">   #单个进程最大连接数（最大连接数=连接数*进程数）该值受系统进程最大打开文件数限制，需要使用命令ulimit -n 查看当前设置
</span><span style="display:block;padding:0 1.25rem">   worker_connections 65535;
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">#设定http服务器
</span><span style="display:block;padding:0 1.25rem">http {
</span><span style="display:block;padding:0 1.25rem">    #文件扩展名与文件类型映射表
</span><span style="display:block;padding:0 1.25rem">    #include 是个主模块指令，可以将配置文件拆分并引用，可以减少主配置文件的复杂度
</span><span style="display:block;padding:0 1.25rem">    include       mime.types;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #默认文件类型
</span><span style="display:block;padding:0 1.25rem">    default_type  application/octet-stream;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #默认编码
</span><span style="display:block;padding:0 1.25rem">    #charset utf-8; 
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #定义虚拟主机日志的格式
</span><span style="display:block;padding:0 1.25rem">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;
</span><span style="display:block;padding:0 1.25rem">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;
</span><span style="display:block;padding:0 1.25rem">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #定义虚拟主机访问日志
</span><span style="display:block;padding:0 1.25rem">    #access_log  logs/access.log  main;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。
</span><span style="display:block;padding:0 1.25rem">    sendfile        on;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #开启目录列表访问，合适下载服务器，默认关闭。
</span><span style="display:block;padding:0 1.25rem">    #autoindex on; 
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #防止网络阻塞
</span><span style="display:block;padding:0 1.25rem">    #tcp_nopush     on;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #长连接超时时间，单位是秒，默认为0
</span><span style="display:block;padding:0 1.25rem">    keepalive_timeout  65;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #gzip压缩功能设置
</span><span style="display:block;padding:0 1.25rem">    gzip on; #开启gzip压缩输出
</span><span style="display:block;padding:0 1.25rem">    gzip_min_length 1k; #最小压缩文件大小
</span><span style="display:block;padding:0 1.25rem">    gzip_buffers    4 16k; #压缩缓冲区
</span><span style="display:block;padding:0 1.25rem">    gzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）
</span><span style="display:block;padding:0 1.25rem">    gzip_comp_level 6; #压缩等级
</span><span style="display:block;padding:0 1.25rem">    #压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。
</span><span style="display:block;padding:0 1.25rem">    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;
</span><span style="display:block;padding:0 1.25rem">    gzip_vary on; //和http头有关系，加个vary头，给代理服务器用的，有的浏览器支持压缩，有的不支持，所以避免浪费不支持的也压缩，所以根据客户端的HTTP头来判断，是否需要压缩
</span><span style="display:block;padding:0 1.25rem">    
</span><span style="display:block;padding:0 1.25rem">    #开启限制IP连接数的时候需要使用
</span><span style="display:block;padding:0 1.25rem">    #limit_zone crawler $binary_remote_addr 10m; 
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #http_proxy服务全局设置
</span><span style="display:block;padding:0 1.25rem">    client_max_body_size   10m;
</span><span style="display:block;padding:0 1.25rem">    client_body_buffer_size   128k;
</span><span style="display:block;padding:0 1.25rem">    proxy_connect_timeout   75;
</span><span style="display:block;padding:0 1.25rem">    proxy_send_timeout   75;
</span><span style="display:block;padding:0 1.25rem">    proxy_read_timeout   75;
</span><span style="display:block;padding:0 1.25rem">    proxy_buffer_size   4k;
</span><span style="display:block;padding:0 1.25rem">    proxy_buffers   4 32k;
</span><span style="display:block;padding:0 1.25rem">    proxy_busy_buffers_size   64k;
</span><span style="display:block;padding:0 1.25rem">    proxy_temp_file_write_size  64k;
</span><span style="display:block;padding:0 1.25rem">    proxy_temp_path   /usr/local/nginx/proxy_temp 1 2;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #设定负载均衡后台服务器列表 
</span><span style="display:block;padding:0 1.25rem">    upstream backend.com {
</span><span style="display:block;padding:0 1.25rem">        #ip_hash; # 指定支持的调度算法
</span><span style="display:block;padding:0 1.25rem">        #upstream 的负载均衡，weight 是权重，可以根据机器配置定义权重。weigth 参数表示权值，权值越高被分配到的几率越大。
</span><span style="display:block;padding:0 1.25rem">        server   192.168.10.100:8080 max_fails=2 fail_timeout=30s;
</span><span style="display:block;padding:0 1.25rem">        server   192.168.10.101:8080 max_fails=2 fail_timeout=30s;
</span><span style="display:block;padding:0 1.25rem">    }
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #虚拟主机的配置
</span><span style="display:block;padding:0 1.25rem">    server {
</span><span style="display:block;padding:0 1.25rem">        #监听端口
</span><span style="display:block;padding:0 1.25rem">        listen       80;
</span><span style="display:block;padding:0 1.25rem">    
</span><span style="display:block;padding:0 1.25rem">        #域名可以有多个，用空格隔开
</span><span style="display:block;padding:0 1.25rem">        server_name  localhost fontend.com;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #Server Side Include，通常称为服务器端嵌入
</span><span style="display:block;padding:0 1.25rem">        #ssi on;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #默认编码
</span><span style="display:block;padding:0 1.25rem">        #charset utf-8;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #定义本虚拟主机的访问日志
</span><span style="display:block;padding:0 1.25rem">        #access_log  logs/host.access.log  main;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求
</span><span style="display:block;padding:0 1.25rem">        location / {
</span><span style="display:block;padding:0 1.25rem">            root   html;
</span><span style="display:block;padding:0 1.25rem">            index  index.html index.htm;
</span><span style="display:block;padding:0 1.25rem">        }
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #error_page  404              /404.html;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #redirect server error pages to the static page /50x.html
</span><span style="display:block;padding:0 1.25rem">        #error_page   500 502 503 504  /50x.html;
</span><span style="display:block;padding:0 1.25rem">        location = /50x.html {
</span><span style="display:block;padding:0 1.25rem">            root   html;
</span><span style="display:block;padding:0 1.25rem">        }
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #图片缓存时间设置
</span><span style="display:block;padding:0 1.25rem">        location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$ {
</span><span style="display:block;padding:0 1.25rem">           expires 10d;
</span><span style="display:block;padding:0 1.25rem">        }
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #JS和CSS缓存时间设置
</span><span style="display:block;padding:0 1.25rem">        location ~ .*.(js|css)?$ {
</span><span style="display:block;padding:0 1.25rem">           expires 1h;
</span><span style="display:block;padding:0 1.25rem">        }
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        #代理配置
</span><span style="display:block;padding:0 1.25rem">        #proxy the PHP scripts to Apache listening on 127.0.0.1:80
</span><span style="display:block;padding:0 1.25rem">        #location /proxy/ {
</span><span style="display:block;padding:0 1.25rem">        #    proxy_pass   http://127.0.0.1;
</span><span style="display:block;padding:0 1.25rem">        #}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
</span><span style="display:block;padding:0 1.25rem">        #
</span><span style="display:block;padding:0 1.25rem">        #location ~ \.php$ {
</span><span style="display:block;padding:0 1.25rem">        #    root           html;
</span><span style="display:block;padding:0 1.25rem">        #    fastcgi_pass   127.0.0.1:9000;
</span><span style="display:block;padding:0 1.25rem">        #    fastcgi_index  index.php;
</span><span style="display:block;padding:0 1.25rem">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
</span><span style="display:block;padding:0 1.25rem">        #    include        fastcgi_params;
</span><span style="display:block;padding:0 1.25rem">        #}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">        # deny access to .htaccess files, if Apache&#x27;s document root
</span><span style="display:block;padding:0 1.25rem">        # concurs with nginx&#x27;s one
</span><span style="display:block;padding:0 1.25rem">        #
</span><span style="display:block;padding:0 1.25rem">        #location ~ /\.ht {
</span><span style="display:block;padding:0 1.25rem">        #    deny  all;
</span><span style="display:block;padding:0 1.25rem">        #}
</span><span style="display:block;padding:0 1.25rem">    }
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    # another virtual host using mix of IP-, name-, and port-based configuration
</span><span style="display:block;padding:0 1.25rem">    #
</span><span style="display:block;padding:0 1.25rem">    #server {
</span><span style="display:block;padding:0 1.25rem">    #    listen       8000;
</span><span style="display:block;padding:0 1.25rem">    #    listen       somename:8080;
</span><span style="display:block;padding:0 1.25rem">    #    server_name  somename  alias  another.alias;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    #    location / {
</span><span style="display:block;padding:0 1.25rem">    #        root   html;
</span><span style="display:block;padding:0 1.25rem">    #        index  index.html index.htm;
</span><span style="display:block;padding:0 1.25rem">    #    }
</span><span style="display:block;padding:0 1.25rem">    #}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">    # HTTPS server
</span><span style="display:block;padding:0 1.25rem">    #
</span><span style="display:block;padding:0 1.25rem">    #server {
</span><span style="display:block;padding:0 1.25rem">    #    listen       443 ssl;
</span><span style="display:block;padding:0 1.25rem">    #    server_name  localhost;
</span><span style="display:block;padding:0 1.25rem">    #    ssl_certificate      cert.pem;
</span><span style="display:block;padding:0 1.25rem">    #    ssl_certificate_key  cert.key;
</span><span style="display:block;padding:0 1.25rem">    #    ssl_session_cache    shared:SSL:1m;
</span><span style="display:block;padding:0 1.25rem">    #    ssl_session_timeout  5m;
</span><span style="display:block;padding:0 1.25rem">    #    ssl_ciphers  HIGH:!aNULL:!MD5;
</span><span style="display:block;padding:0 1.25rem">    #    ssl_prefer_server_ciphers  on;
</span><span style="display:block;padding:0 1.25rem">    #    location / {
</span><span style="display:block;padding:0 1.25rem">    #        root   html;
</span><span style="display:block;padding:0 1.25rem">    #        index  index.html index.htm;
</span><span style="display:block;padding:0 1.25rem">    #    }
</span><span style="display:block;padding:0 1.25rem">    #}
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg width="32" height="32" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><strong class="font-semibold">location如何匹配？</strong></p>
<p class="my-4 leading-7">以 = 开头表示精确匹配
^~ 开头表示uri以某个常规字符串开头，不是正则匹配
~ 开头表示区分大小写的正则匹配
<del>* 开头表示不区分大小写的正则匹配
/ 通用匹配, 如果没有其它匹配,任何请求都会匹配到
优先级：
(location =) &gt; (location 完整路径) &gt; (location ^</del> 路径) &gt; (location <del>,</del>* 正则顺序) &gt; (location 部分起始路径) &gt; (/)</p>
<div class="language-nginx"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-nginx" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>location  = / {
</span></span><span style="display:block;padding:0 1.25rem">  # 精确匹配 / ，主机名后面不能带任何字符串
</span><span style="display:block;padding:0 1.25rem">  [ configuration A ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location  / {
</span><span style="display:block;padding:0 1.25rem">  # 因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求
</span><span style="display:block;padding:0 1.25rem">  # 但是正则和最长字符串会优先匹配
</span><span style="display:block;padding:0 1.25rem">  [ configuration B ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location /documents/ {
</span><span style="display:block;padding:0 1.25rem">  # 匹配任何以 /documents/ 开头的地址，匹配符合以后，还要继续往下搜索
</span><span style="display:block;padding:0 1.25rem">  # 只有后面的正则表达式没有匹配到时，这一条才会采用这一条
</span><span style="display:block;padding:0 1.25rem">  [ configuration C ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location ~ /documents/Abc {
</span><span style="display:block;padding:0 1.25rem">  # 匹配任何以 /documents/ 开头的地址，匹配符合以后，还要继续往下搜索
</span><span style="display:block;padding:0 1.25rem">  # 只有后面的正则表达式没有匹配到时，这一条才会采用这一条
</span><span style="display:block;padding:0 1.25rem">  [ configuration CC ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location ~* \.(gif|jpg|jpeg)$ {
</span><span style="display:block;padding:0 1.25rem">  # 匹配所有以 gif,jpg或jpeg 结尾的请求
</span><span style="display:block;padding:0 1.25rem">  # 然而，所有请求 /images/ 下的图片会被 config D 处理，因为 ^~ 到达不了这一条正则
</span><span style="display:block;padding:0 1.25rem">  [ configuration E ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location ^~ /images/ {
</span><span style="display:block;padding:0 1.25rem">  # 匹配任何以 /images/ 开头的地址，匹配符合以后，停止往下搜索正则，采用这一条。
</span><span style="display:block;padding:0 1.25rem">  [ configuration D ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location /images/ {
</span><span style="display:block;padding:0 1.25rem">  # 字符匹配到 /images/，继续往下，会发现 ^~ 存在
</span><span style="display:block;padding:0 1.25rem">  [ configuration F ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location /images/abc {
</span><span style="display:block;padding:0 1.25rem">  # 最长字符匹配到 /images/abc，继续往下，会发现 ^~ 存在
</span><span style="display:block;padding:0 1.25rem">  # F与G的放置顺序是没有关系的
</span><span style="display:block;padding:0 1.25rem">  [ configuration G ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location ~ /images/abc/ {
</span><span style="display:block;padding:0 1.25rem">  # 只有去掉 config D 才有效：先最长匹配 config G 开头的地址，继续往下搜索，匹配到这一条正则，采用
</span><span style="display:block;padding:0 1.25rem">  [ configuration H ] 
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location ~* /js/.*/\.js {
</span><span style="display:block;padding:0 1.25rem">  [ configuration I ] 
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg width="32" height="32" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><strong class="font-semibold">如何配置反向代理？</strong></p>
<div class="language-nginx"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-nginx" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span># 对 “/” 启用反向代理
</span></span><span style="display:block;padding:0 1.25rem">location / {
</span><span style="display:block;padding:0 1.25rem">  
</span><span style="display:block;padding:0 1.25rem">  # 设置要代理的 uri，注意最后的 /。可以是 Unix 域套接字路径，也可以是正则表达式。
</span><span style="display:block;padding:0 1.25rem">  proxy_pass http://127.0.0.1:3000;
</span><span style="display:block;padding:0 1.25rem">  
</span><span style="display:block;padding:0 1.25rem">  # 设置后端服务器“Location”响应头和“Refresh”响应头的替换文本
</span><span style="display:block;padding:0 1.25rem">  proxy_redirect off; 
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">  # 获取用户的真实 IP 地址
</span><span style="display:block;padding:0 1.25rem">  proxy_set_header X-Real-IP $remote_addr; 
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">  #后端的Web服务器可以通过 X-Forwarded-For 获取用户真实IP，多个 nginx 反代的情况下，例如 CDN。参见：http://gong1208.iteye.com/blog/1559835 和 http://bbs.linuxtone.org/thread-9050-1-1.html
</span><span style="display:block;padding:0 1.25rem">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">  #以下是一些反向代理的配置，可选。
</span><span style="display:block;padding:0 1.25rem">  # 允许重新定义或者添加发往后端服务器的请求头。
</span><span style="display:block;padding:0 1.25rem">  proxy_set_header Host $host;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">  client_max_body_size 10m; #允许客户端请求的最大单文件字节数
</span><span style="display:block;padding:0 1.25rem">  client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，
</span><span style="display:block;padding:0 1.25rem">  proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)
</span><span style="display:block;padding:0 1.25rem">  proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)
</span><span style="display:block;padding:0 1.25rem">  proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)
</span><span style="display:block;padding:0 1.25rem">  proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小
</span><span style="display:block;padding:0 1.25rem">  proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的设置
</span><span style="display:block;padding:0 1.25rem">  proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）
</span><span style="display:block;padding:0 1.25rem">  proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg width="32" height="32" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">来个实例看看：</p>
<div class="language-nginx"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-nginx" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>location ^~ /service/ {
</span></span><span style="display:block;padding:0 1.25rem">  proxy_pass http://192.168.60.245:8080/;
</span><span style="display:block;padding:0 1.25rem">  proxy_redirect      default;
</span><span style="display:block;padding:0 1.25rem">  proxy_set_header    Host $host
</span><span style="display:block;padding:0 1.25rem">  proxy_set_header    X-Real-IP $remote_addr;
</span><span style="display:block;padding:0 1.25rem">  proxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;
</span><span style="display:block;padding:0 1.25rem">}
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">location /proxy/ {
</span><span style="display:block;padding:0 1.25rem">  proxy_pass http://backend.com/;
</span><span style="display:block;padding:0 1.25rem">  proxy_redirect      default;
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg width="32" height="32" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><strong class="font-semibold">如何配置rewrite？</strong></p>
<p class="my-4 leading-7">rewrite功能就是集合正则表达式和标志位实现url重写和重定向。</p>
<p class="my-4 leading-7">rewrite只能放在server{}、location{}、if(){}块中，并且只能对域名后边的出去传递参数外的字符串起作用。如URL：</p>
<p class="my-4 leading-7"><a href="http://microloan-sms-platform.yxapp.xyz/proxy/sms/task/querydeleted?page=1&amp;pagesize=10" target="_blank" rel="noopener noreferrer" class="link_03735  link_3b154 inline-link_3b154">http://microloan-sms-platform.yxapp.xyz/proxy/sms/task/querydeleted?page=1&amp;pagesize=10</a></p>
<p class="my-4 leading-7">只对/proxy/sms/task/querydeleted进行重写。</p>
<p class="my-4 leading-7">如果相对域名或参数字符串起作用，可以使用全局变量匹配，也可以使用proxy_pass反向代理。</p>
<p class="my-4 leading-7">表明看rewrite和location功能有点像，都能实现跳转，主要区别在于rewrite是在同一域名内更改获取资源的路径，而location是对一类路径做控制访问或反向代理，可以proxy_pass到其他机器。很多情况下rewrite也会写在location里，它们的执行顺序是：</p>
<p class="my-4 leading-7">执行server块的rewrite指令执行location匹配执行选定的location中的rewrite指令</p>
<p class="my-4 leading-7">如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件；循环超过10次，则返回500 Internal Server Error错误。</p>
<p class="my-4 leading-7">rewrite规则后边，通常会带有flag标志位：</p>
<p class="my-4 leading-7">last : 相当于Apache的[L]标记，表示完成rewritebreak : 停止执行当前虚拟主机的后续rewrite指令集redirect : 返回302临时重定向，地址栏会显示跳转后的地址permanent : 返回301永久重定向，地址栏会显示跳转后的地址</p>
<p class="my-4 leading-7">last 和 break 区别：</p>
<p class="my-4 leading-7">last一般写在server和if中，而break一般使用在location中last不终止重写后的url匹配，即新的url会再从server走一遍匹配流程，而break终止重写后的匹配break和last都能组织继续执行后面的rewrite指令</p>
<p class="my-4 leading-7">rewrite常用正则：</p>
<p class="my-4 leading-7">. ： 匹配除换行符以外的任意字符? ： 重复0次或1次 ： 重复1次或更多次* ： 重复0次或更多次\d ：匹配数字^ ： 匹配字符串的开始$ ： 匹配字符串的介绍{n} ： 重复n次{n,} ： 重复n次或更多次 ： 匹配单个字符c[a-z] ： 匹配a-z小写字母的任意一个</p>
<p class="my-4 leading-7">可以使用()来进行分组，可以通过$1的形式来引用。</p>
<div class="language-nginx"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-nginx" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>location /proxy/ {
</span></span><span style="display:block;padding:0 1.25rem">    proxy_pass http://microloan-notification-web.yxapp.in;
</span><span style="display:block;padding:0 1.25rem">    rewrite /proxy/(.*)$ /$1 break;
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg width="32" height="32" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><strong class="font-semibold">如何配置负载均衡？</strong></p>
<p class="my-4 leading-7">upstream是Nginx的HTTP Upstream模块，这个模块通过一个简单的调度算法来实现客户端IP到后端服务器的负载均衡。</p>
<p class="my-4 leading-7">Nginx的负载均衡模块目前支持4种调度算法：</p>
<p class="my-4 leading-7">轮询（默认）。每个请求按时间顺序逐一分配到不同的后端服务器，如果后端某台服务器宕机，故障系统被自动剔除，使用户访问不受影响。Weight 指定轮询权值，Weight值越大，分配到的访问机率越高，主要用于后端每个服务器性能不均的情况下。ip_hash。每个请求按访问IP的hash结果分配，这样来自同一个IP的访客固定访问一个后端服务器，有效解决了动态网页存在的session共享问题。fair。这是比上面两个更加智能的负载均衡算法。此种算法可以依据页面大小和加载时间长短智能地进行负载均衡，也就是根据后端服务器的响应时间来分配请求，响应时间短的优先分配。Nginx本身是不支持fair的，如果需要使用这种调度算法，必须下载Nginx的upstream_fair模块。url_hash。此方法按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，可以进一步提高后端缓存服务器的效率。Nginx本身是不支持url_hash的，如果需要使用这种调度算法，必须安装Nginx 的hash软件包。</p>
<p class="my-4 leading-7">upstream可以设定每个后端服务器在负载均衡调度中的状态，支持的状态参数:</p>
<p class="my-4 leading-7">down，表示当前的server暂时不参与负载均衡backup，预留的备份机器。当其他所有的非backup机器出现故障或者忙的时候，才会请求backup机器，因此这台机器的压力最轻。max_fails，允许请求失败的次数，默认为1。当超过最大次数时，返回proxy_next_upstream 模块定义的错误。fail_timeout，在经历了max_fails次失败后，暂停服务的时间。max_fails可以和fail_timeout一起使用。</p>
<p class="my-4 leading-7">注，当负载调度算法为ip_hash时，后端服务器在负载均衡调度中的状态不能是weight和backup。</p>
<div class="language-nginx"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-nginx" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>upstream test.net{
</span></span><span style="display:block;padding:0 1.25rem">   ip_hash;
</span><span style="display:block;padding:0 1.25rem">   server 192.168.11.1:80;
</span><span style="display:block;padding:0 1.25rem">   server 192.168.11.11:80  down;
</span><span style="display:block;padding:0 1.25rem">   server 192.168.11.123:8009  max_fails=3  fail_timeout=20s;
</span><span style="display:block;padding:0 1.25rem">   server 192.168.11.1234:8080;
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg width="32" height="32" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><strong class="font-semibold">如何设置页面缓存？</strong></p>
<p class="my-4 leading-7">页面缓存设置指令：</p>
<p class="my-4 leading-7">proxy_cache_path : 指定缓存的路径和一些其他参数，缓存的数据存储在文件中，并且使用代理url的哈希值作为关键字与文件名。</p>
<p class="my-4 leading-7">proxy_cache_path /data/nginx/cache/webserver levels=1:2 keys_zone=webserver:20m max_size=1g;</p>
<p class="my-4 leading-7">levels参数指定缓存的子目录数。keys_zone指定活动的key和元数据存储在共享池（webserver为共享池名称，20m位共享池大小），inactive参数指定的时间内缓存的数据没有被请求则被删除，默认inactive为10分钟·max_size指定缓存空间的大小。</p>
<p class="my-4 leading-7">proxy_cache : 设置一个缓存区域的名称，一个相同的区域可以在不同的地方使用。proxy_cache_valid : 为不同的应答设置不同的缓存时间。如何设置读写分离？</p>
<p class="my-4 leading-7">proxy_cache_valid : 为不同的应答设置不同的缓存时间。如何设置读写分离？</p>
<div class="language-nginx"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-nginx" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>proxy_cache_path /nginx/cache/webpages levels=1:2 keys_zone=webpages:30mmax_size=2g;
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">server {
</span><span style="display:block;padding:0 1.25rem">  listen       80;
</span><span style="display:block;padding:0 1.25rem">  server_name  localhost;
</span><span style="display:block;padding:0 1.25rem">  charset utf-8;
</span><span style="display:block;padding:0 1.25rem">  
</span><span style="display:block;padding:0 1.25rem">  #add headers
</span><span style="display:block;padding:0 1.25rem">  add_header X-Via $server_addr;
</span><span style="display:block;padding:0 1.25rem">  add_header X-Cache $upstream_cache_status;
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">  location / {
</span><span style="display:block;padding:0 1.25rem">    proxy_pass http://webservers;
</span><span style="display:block;padding:0 1.25rem">    proxy_set_header X-Real-IP $remote_addr;
</span><span style="display:block;padding:0 1.25rem">    proxy_cache webpages;
</span><span style="display:block;padding:0 1.25rem">    proxy_cache_valid 20010m;
</span><span style="display:block;padding:0 1.25rem">  }
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg width="32" height="32" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div><!--/$--></div><div class="rspress-doc-footer"><div class="postFooter_9487e flex flex-col"><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_2a070 flex flex-col"><a class="link_03735 pagerLink_2a070 cursor-pointer" target="" href="/2024/02/27/nodejs-configuration/index.html"><span class="desc_2a070">上一篇</span><span class="title_2a070">配置nodejs环境</span></a></div><div class="next_2a070 flex flex-col"><a class="link_03735 pagerLink_2a070 next_2a070 cursor-pointer" target="" href="/2024/02/29/linux-command/index.html"><span class="desc_2a070">下一篇</span><span class="title_2a070">Linux常用命令</span></a></div></div></div><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"><div class="flex text-sm text-text-2 leading-6 sm:leading-8 font-medium"><p>最后编辑时间<!-- -->: </p><span>2024/2/27 09:41:36</span></div></div><div class="flex flex-col"><a href="https://github.com/zhifou/zhifou.github.io/tree/main/site/source/../source/_posts/2024-02-27-nginx-configuration.md" target="_blank" class="editLink_2a169">📝 在 GitHub 上编辑此页</a></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_e7091 flex flex-col"></div><div class="next_e7091 flex flex-col"></div></div></footer></div></div></div><div class="aside-container_edeb4"><div><div class="postInfoContainer_4a868"><div class="leading-7 block text-sm font-semibold pl-3">文章信息</div><div class="postInfoItem_4a868 block"><span class="postInfoLabel_4a868">分类：</span><span class="undefined">Web服务器</span></div><div class="postInfoItem_4a868 block"><span class="postInfoLabel_4a868">标签：</span><span class="undefined">nginx</span></div><div class="postInfoItem_4a868 block"><span class="postInfoLabel_4a868">发表于：</span><span class="undefined">2024-02-27</span></div><div class="postInfoItem_4a868 block"><span class="postInfoLabel_4a868">字数统计：</span><span class="undefined">1.6k<!-- --> 字</span></div><div class="postInfoItem_4a868 block"><span class="postInfoLabel_4a868">阅读时长：</span><span class="undefined">5<!-- --> 分钟</span></div><div class="postInfoItem_4a868 block"><span class="postInfoLabel_4a868">阅读量：</span><span class="undefined"></span></div></div><div class="flex flex-col"><div class="&lt;lg:hidden"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">目录</div><nav class="mt-1"><ul class="relative"><li><a href="#nginxconf基本配置有哪些" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">nginx.conf基本配置有哪些？</span></a></li></ul></nav></div></div></div></div></div></div></div></section><footer class="mt-6 py-8 px-6 sm:p-8 w-full border-t border-solid border-divider-light"><div class="m-auto w-full text-center"><div class="font-meduim text-sm text-text-2">© 2015-<!-- -->2024<!-- --> zhifou. Powered by<!-- --> <a href="https://rspress.dev/" target="_blank" rel="noreferrer">Rspress</a>.</div></div></footer></div></div></div><div id="search-container"></div></body></html>